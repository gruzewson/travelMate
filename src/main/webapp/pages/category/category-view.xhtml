<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" xmlns:h="jakarta.faces.html" xmlns:f="jakarta.faces.core"
    xmlns:ui="jakarta.faces.facelets">

<ui:composition template="/templates/template.xhtml">
    <f:metadata>
        <f:viewParam name="id" value="#{categoryDetailBean.categoryId}" converter="uuidConverter" />
        <f:event type="preRenderView" listener="#{categoryDetailBean.init}" />
    </f:metadata>

    <ui:define name="content">

        <article>
            <header>
                <h2>#{msg['category.details']}: #{categoryDetailBean.category.name}</h2>
            </header>

            <section>
                <dl>
                    <dt><strong>#{msg['category.id']}:</strong></dt>
                    <dd>#{categoryDetailBean.category.id}</dd>

                    <dt><strong>#{msg['category.name']}:</strong></dt>
                    <dd>#{categoryDetailBean.category.name}</dd>

                    <dt><strong>#{msg['category.description']}:</strong></dt>
                    <dd>#{categoryDetailBean.category.description}</dd>
                </dl>
            </section>

            <section>

                <div style="margin: 15px;">
                    <h:link outcome="/pages/trip/trip-edit" value="#{msg['category.addTrip']}" styleClass="button-link">
                        <f:param name="categoryId" value="#{categoryDetailBean.categoryId}" />
                    </h:link>
                </div>

                <h:form id="filterForm">
                    <!-- Filter Panel -->
                    <fieldset style="margin-bottom: 20px; padding: 15px; border: 1px solid #ddd; border-radius: 6px; background-color: #f9f9f9;">
                        <legend style="font-weight: bold; padding: 0 10px;">#{msg['filter.title']}</legend>

                        <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 15px;">

                            <!-- Title Filter -->
                            <div>
                                <h:outputLabel for="filterTitle" value="#{msg['trip.titleLabel']}:" style="display: block; margin-bottom: 5px; font-weight: bold;" />
                                <h:inputText id="filterTitle" value="#{categoryDetailBean.filterTitle}"
                                    style="width: 100%; padding: 8px; border: 1px solid #ccc; border-radius: 4px;" />
                            </div>

                            <!-- Start Date From -->
                            <div>
                                <h:outputLabel for="filterStartDateFrom" value="#{msg['filter.startDateFrom']}:" style="display: block; margin-bottom: 5px; font-weight: bold;" />
                                <h:inputText id="filterStartDateFrom" value="#{categoryDetailBean.filterStartDateFrom}"
                                    type="date" style="width: 100%; padding: 8px; border: 1px solid #ccc; border-radius: 4px;">
                                    <f:convertDateTime pattern="yyyy-MM-dd" type="localDate"/>
                                </h:inputText>
                            </div>

                            <!-- Start Date To -->
                            <div>
                                <h:outputLabel for="filterStartDateTo" value="#{msg['filter.startDateTo']}:" style="display: block; margin-bottom: 5px; font-weight: bold;" />
                                <h:inputText id="filterStartDateTo" value="#{categoryDetailBean.filterStartDateTo}"
                                    type="date" style="width: 100%; padding: 8px; border: 1px solid #ccc; border-radius: 4px;">
                                    <f:convertDateTime pattern="yyyy-MM-dd" type="localDate"/>
                                </h:inputText>
                            </div>

                            <!-- End Date From -->
                            <div>
                                <h:outputLabel for="filterEndDateFrom" value="#{msg['filter.endDateFrom']}:" style="display: block; margin-bottom: 5px; font-weight: bold;" />
                                <h:inputText id="filterEndDateFrom" value="#{categoryDetailBean.filterEndDateFrom}"
                                    type="date" style="width: 100%; padding: 8px; border: 1px solid #ccc; border-radius: 4px;">
                                    <f:convertDateTime pattern="yyyy-MM-dd" type="localDate"/>
                                </h:inputText>
                            </div>

                            <!-- End Date To -->
                            <div>
                                <h:outputLabel for="filterEndDateTo" value="#{msg['filter.endDateTo']}:" style="display: block; margin-bottom: 5px; font-weight: bold;" />
                                <h:inputText id="filterEndDateTo" value="#{categoryDetailBean.filterEndDateTo}"
                                    type="date" style="width: 100%; padding: 8px; border: 1px solid #ccc; border-radius: 4px;">
                                    <f:convertDateTime pattern="yyyy-MM-dd" type="localDate"/>
                                </h:inputText>
                            </div>

                            <!-- Min Cost -->
                            <div>
                                <h:outputLabel for="filterMinCost" value="#{msg['filter.minCost']}:" style="display: block; margin-bottom: 5px; font-weight: bold;" />
                                <h:inputText id="filterMinCost" value="#{categoryDetailBean.filterMinCost}"
                                    style="width: 100%; padding: 8px; border: 1px solid #ccc; border-radius: 4px;">
                                    <f:convertNumber type="number" />
                                </h:inputText>
                            </div>

                            <!-- Max Cost -->
                            <div>
                                <h:outputLabel for="filterMaxCost" value="#{msg['filter.maxCost']}:" style="display: block; margin-bottom: 5px; font-weight: bold;" />
                                <h:inputText id="filterMaxCost" value="#{categoryDetailBean.filterMaxCost}"
                                    style="width: 100%; padding: 8px; border: 1px solid #ccc; border-radius: 4px;">
                                    <f:convertNumber type="number" />
                                </h:inputText>
                            </div>

                            <!-- Status Filter -->
                            <div>
                                <h:outputLabel for="filterStatus" value="#{msg['trip.statusLabel']}:" style="display: block; margin-bottom: 5px; font-weight: bold;" />
                                <h:selectOneMenu id="filterStatus" value="#{categoryDetailBean.filterStatus}"
                                    style="width: 100%; padding: 8px; border: 1px solid #ccc; border-radius: 4px;">
                                    <f:selectItem itemLabel="#{msg['filter.allStatuses']}" noSelectionOption="true" />
                                    <f:selectItems value="#{categoryDetailBean.tripStatuses}" var="status"
                                        itemValue="#{status}" itemLabel="#{status}" />
                                </h:selectOneMenu>
                            </div>
                        </div>

                        <!-- Filter Buttons -->
                        <div style="margin-top: 15px; display: flex; gap: 10px;">
                            <h:commandButton value="#{msg['filter.apply']}" action="#{categoryDetailBean.applyFilters}"
                                style="padding: 10px 20px; background-color: #007bff; color: white; border: none; border-radius: 4px; cursor: pointer;">
                                <f:ajax execute="@form" render="tripTablePanel" />
                            </h:commandButton>
                            <h:commandButton value="#{msg['filter.clear']}" action="#{categoryDetailBean.clearFilters}"
                                style="padding: 10px 20px; background-color: #6c757d; color: white; border: none; border-radius: 4px; cursor: pointer;">
                                <f:ajax execute="@form" render="tripTablePanel" />
                            </h:commandButton>
                        </div>
                    </fieldset>

                    <h:messages id="messages" globalOnly="true" styleClass="messages" />


                    <h:panelGroup id="tripTablePanel">
                        <h:dataTable value="#{categoryDetailBean.trips}" var="trip" styleClass="table"
                            headerClass="table-header" rowClasses="table-odd-row,table-even-row"
                            rendered="#{not empty categoryDetailBean.trips}">

                            <h:column>
                                <f:facet name="header">#{msg['trip.title']}</f:facet>
                                #{trip.title}
                            </h:column>

                            <h:column>
                                <f:facet name="header">#{msg['trip.version']}</f:facet>
                                #{trip.version}
                            </h:column>

                            <h:column>
                                <f:facet name="header">#{msg['trip.createdAt']}</f:facet>
                                <h:outputText value="#{trip.createdAt}">
                                    <f:convertDateTime pattern="dd-MM-yyyy HH:mm" type="localDateTime" />
                                </h:outputText>
                            </h:column>

                            <h:column>
                                <f:facet name="header">#{msg['trip.updatedAt']}</f:facet>
                                <h:outputText value="#{trip.updatedAt}">
                                    <f:convertDateTime pattern="dd-MM-yyyy HH:mm" type="localDateTime" />
                                </h:outputText>
                            </h:column>

                            <h:column>
                                <f:facet name="header">#{msg['trip.startDate']}</f:facet>
                                <h:outputText value="#{trip.startDate}">
                                    <f:convertDateTime pattern="dd-MM-yyyy" type="localDate" />
                                </h:outputText>
                            </h:column>

                            <h:column>
                                <f:facet name="header">#{msg['trip.endDate']}</f:facet>
                                <h:outputText value="#{trip.endDate}">
                                    <f:convertDateTime pattern="dd-MM-yyyy" type="localDate" />
                                </h:outputText>
                            </h:column>

                            <h:column>
                                <f:facet name="header">#{msg['trip.cost']}</f:facet>
                                <h:outputText value="#{trip.estimatedCost}">
                                    <f:convertNumber type="currency" currencySymbol="PLN " />
                                </h:outputText>
                            </h:column>

                            <h:column>
                                <f:facet name="header">#{msg['trip.status']}</f:facet>
                                #{trip.status}
                            </h:column>

                            <h:column rendered="#{authBean.admin}">
                                <f:facet name="header">#{msg['trip.owner']}</f:facet>
                                #{trip.user.login}
                            </h:column>

                            <h:column>
                                <f:facet name="header">#{msg['trip.actions']}</f:facet>

                                <h:link value="#{msg['trip.show']}" outcome="/pages/trip/trip-view"
                                    style="margin-right: 10px;">
                                    <f:param name="id" value="#{trip.id}" />
                                </h:link>

                                <h:link value="#{msg['trip.edit']}" outcome="/pages/trip/trip-edit"
                                    style="margin-right: 10px;">
                                    <f:param name="id" value="#{trip.id}" />
                                    <f:param name="categoryId" value="#{categoryDetailBean.categoryId}" />
                                </h:link>

                                <h:commandButton value="#{msg['trip.delete']}"
                                    action="#{categoryDetailBean.deleteTrip(trip.id)}"
                                    onclick="return confirm(this.getAttribute('data-confirm'));"
                                    rendered="#{authBean.admin or (trip.user.id eq authBean.currentUser.id)}">
                                    <f:passThroughAttribute name="data-confirm" value="#{msg['trip.deleteConfirm']}" />
                                    <f:ajax execute="@form" render="tripTablePanel messages" />
                                </h:commandButton>
                            </h:column>

                        </h:dataTable>

                        <h:panelGroup rendered="#{empty categoryDetailBean.trips}">
                            <p style="font-style: italic; color: #666;">#{msg['category.noTrips']}</p>
                        </h:panelGroup>
                    </h:panelGroup>
                </h:form>

            </section>

            <nav style="margin-top: 20px;">
                <h:link value="#{msg['category.backToList']}" outcome="/pages/category/categories" />
            </nav>
        </article>

    </ui:define>

</ui:composition>

</html>

