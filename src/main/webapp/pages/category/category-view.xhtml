<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml"
      xmlns:h="jakarta.faces.html"
      xmlns:f="jakarta.faces.core"
      xmlns:ui="jakarta.faces.facelets">

<ui:composition template="/templates/template.xhtml">
    <f:metadata>
        <f:viewParam name="id" value="#{categoryDetailBean.categoryId}" converter="uuidConverter" />
        <f:event type="preRenderView" listener="#{categoryDetailBean.init}" />
    </f:metadata>

    <ui:define name="content">

        <article>
            <header>
                <h2>Category Details: #{categoryDetailBean.category.name}</h2>
            </header>

            <section>
                <dl>
                    <dt><strong>ID:</strong></dt>
                    <dd>#{categoryDetailBean.category.id}</dd>

                    <dt><strong>Name:</strong></dt>
                    <dd>#{categoryDetailBean.category.name}</dd>

                    <dt><strong>Description:</strong></dt>
                    <dd>#{categoryDetailBean.category.description}</dd>
                </dl>
            </section>

            <section>

                <div style="margin: 15px;">
                    <h:link outcome="/pages/trip/trip-edit" value="+ Add New Trip" styleClass="button-link">
                        <f:param name="categoryId" value="#{categoryDetailBean.categoryId}" />
                    </h:link>
                </div>

                <h:form rendered="#{not empty categoryDetailBean.trips}">
                    <h:dataTable value="#{categoryDetailBean.trips}" var="trip" styleClass="table"
                                 headerClass="table-header" rowClasses="table-odd-row,table-even-row">

                        <h:column>
                            <f:facet name="header">Title</f:facet>
                            #{trip.title}
                        </h:column>

                        <h:column>
                            <f:facet name="header">Start Date</f:facet>
                            <h:outputText value="#{trip.startDate}">
                                <f:convertDateTime pattern="dd-MM-yyyy" type="localDate"/>
                            </h:outputText>
                        </h:column>

                        <h:column>
                            <f:facet name="header">End Date</f:facet>
                            <h:outputText value="#{trip.endDate}">
                                <f:convertDateTime pattern="dd-MM-yyyy" type="localDate"/>
                            </h:outputText>
                        </h:column>

                        <h:column>
                            <f:facet name="header">Cost</f:facet>
                            <h:outputText value="#{trip.estimatedCost}">
                                <f:convertNumber type="currency" currencySymbol="PLN " />
                            </h:outputText>
                        </h:column>

                        <h:column>
                            <f:facet name="header">Status</f:facet>
                            #{trip.status}
                        </h:column>

                        <h:column rendered="#{authBean.admin}">
                            <f:facet name="header">Owner</f:facet>
                            #{trip.user.login}
                        </h:column>

                        <h:column>
                            <f:facet name="header">Actions</f:facet>

                            <h:link value="Show" outcome="/pages/trip/trip-view" style="margin-right: 10px;">
                                <f:param name="id" value="#{trip.id}" />
                            </h:link>

                            <h:link value="Edit" outcome="/pages/trip/trip-edit" style="margin-right: 10px;">
                                <f:param name="id" value="#{trip.id}" />
                                <f:param name="categoryId" value="#{categoryDetailBean.categoryId}" />
                            </h:link>

                            <h:commandButton value="Delete"
                                             action="#{categoryViewBean.deleteTrip(trip.id, categoryDetailBean.categoryId)}"
                                             onclick="return confirm('Are you sure you want to delete this trip?');"
                                             rendered="#{authBean.admin or (trip.user.id eq authBean.currentUser.id)}" />
                        </h:column>

                    </h:dataTable>
                </h:form>

                <h:panelGroup rendered="#{empty categoryDetailBean.trips}">
                    <p style="font-style: italic; color: #666;">No trips in this category.</p>
                </h:panelGroup>

            </section>

            <nav style="margin-top: 20px;">
                <h:link value="â† Back to Categories List" outcome="/pages/category/categories" />
            </nav>
        </article>

    </ui:define>

</ui:composition>
</html>

