<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml"
      xmlns:h="jakarta.faces.html"
      xmlns:f="jakarta.faces.core"
      xmlns:ui="jakarta.faces.facelets">

<ui:composition template="/templates/template.xhtml">
    <f:metadata>
        <f:viewParam name="id" value="#{categoryDetailBean.categoryId}" converter="uuidConverter" />
        <f:event type="preRenderView" listener="#{categoryDetailBean.init}" />
    </f:metadata>

    <ui:define name="content">

        <article>
            <header>
                <h2>#{msg['category.details']}: #{categoryDetailBean.category.name}</h2>
            </header>

            <section>
                <dl>
                    <dt><strong>#{msg['category.id']}:</strong></dt>
                    <dd>#{categoryDetailBean.category.id}</dd>

                    <dt><strong>#{msg['category.name']}:</strong></dt>
                    <dd>#{categoryDetailBean.category.name}</dd>

                    <dt><strong>#{msg['category.description']}:</strong></dt>
                    <dd>#{categoryDetailBean.category.description}</dd>
                </dl>
            </section>

            <section>

                <div style="margin: 15px;">
                    <h:link outcome="/pages/trip/trip-edit" value="#{msg['category.addTrip']}" styleClass="button-link">
                        <f:param name="categoryId" value="#{categoryDetailBean.categoryId}" />
                    </h:link>
                </div>

                <h:form rendered="#{not empty categoryDetailBean.trips}">
                    <h:dataTable value="#{categoryDetailBean.trips}" var="trip" styleClass="table"
                                 headerClass="table-header" rowClasses="table-odd-row,table-even-row">

                        <h:column>
                            <f:facet name="header">#{msg['trip.title']}</f:facet>
                            #{trip.title}
                        </h:column>

                        <h:column>
                            <f:facet name="header">#{msg['trip.startDate']}</f:facet>
                            <h:outputText value="#{trip.startDate}">
                                <f:convertDateTime pattern="dd-MM-yyyy" type="localDate"/>
                            </h:outputText>
                        </h:column>

                        <h:column>
                            <f:facet name="header">#{msg['trip.endDate']}</f:facet>
                            <h:outputText value="#{trip.endDate}">
                                <f:convertDateTime pattern="dd-MM-yyyy" type="localDate"/>
                            </h:outputText>
                        </h:column>

                        <h:column>
                            <f:facet name="header">#{msg['trip.cost']}</f:facet>
                            <h:outputText value="#{trip.estimatedCost}">
                                <f:convertNumber type="currency" currencySymbol="PLN " />
                            </h:outputText>
                        </h:column>

                        <h:column>
                            <f:facet name="header">#{msg['trip.status']}</f:facet>
                            #{trip.status}
                        </h:column>

                        <h:column rendered="#{authBean.admin}">
                            <f:facet name="header">#{msg['trip.owner']}</f:facet>
                            #{trip.user.login}
                        </h:column>

                        <h:column>
                            <f:facet name="header">#{msg['trip.actions']}</f:facet>

                            <h:link value="#{msg['trip.show']}" outcome="/pages/trip/trip-view" style="margin-right: 10px;">
                                <f:param name="id" value="#{trip.id}" />
                            </h:link>

                            <h:link value="#{msg['trip.edit']}" outcome="/pages/trip/trip-edit" style="margin-right: 10px;">
                                <f:param name="id" value="#{trip.id}" />
                                <f:param name="categoryId" value="#{categoryDetailBean.categoryId}" />
                            </h:link>

                            <h:commandButton value="#{msg['trip.delete']}"
                                             action="#{categoryViewBean.deleteTrip(trip.id, categoryDetailBean.categoryId)}"
                                             onclick="return confirm('#{msg['trip.deleteConfirm']}');"
                                             rendered="#{authBean.admin or (trip.user.id eq authBean.currentUser.id)}" />
                        </h:column>

                    </h:dataTable>
                </h:form>

                <h:panelGroup rendered="#{empty categoryDetailBean.trips}">
                    <p style="font-style: italic; color: #666;">#{msg['category.noTrips']}</p>
                </h:panelGroup>

            </section>

            <nav style="margin-top: 20px;">
                <h:link value="#{msg['category.backToList']}" outcome="/pages/category/categories" />
            </nav>
        </article>

    </ui:define>

</ui:composition>
</html>

