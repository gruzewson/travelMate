<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml"
      xmlns:h="jakarta.faces.html"
      xmlns:f="jakarta.faces.core"
      xmlns:ui="jakarta.faces.facelets">

<ui:composition template="/templates/template.xhtml">

    <ui:define name="content">

        <article>
            <header>
                <h2>Category Management</h2>
            </header>

            <section>
                <h:form>
                    <h:messages globalOnly="true" styleClass="messages" />

                    <h:dataTable value="#{categoryViewBean.allCategories}" var="category" styleClass="table"
                                 headerClass="table-header" rowClasses="table-odd-row,table-even-row"
                                 rendered="#{not empty categoryViewBean.allCategories}">

                        <h:column>
                            <f:facet name="header">Category Name</f:facet>
                            #{category.name}
                        </h:column>

                        <h:column>
                            <f:facet name="header">Description</f:facet>
                            #{category.description}
                        </h:column>

                        <h:column>
                            <f:facet name="header">Number of Trips</f:facet>
                            #{categoryViewBean.getTripCount(category.id)}
                        </h:column>

                        <h:column>
                            <f:facet name="header">Actions</f:facet>

                            <h:link value="Show Details" outcome="/pages/category/category-view" styleClass="button-link"
                                    style="margin-right: 10px;">
                                <f:param name="id" value="#{category.id}" />
                            </h:link>

                            <h:commandButton value="Delete (with trips)"
                                             action="#{categoryViewBean.deleteCategory(category.id)}"
                                             onclick="return confirm('Are you sure you want to delete this category and all its trips?');"
                                             rendered="#{authBean.admin}" />
                        </h:column>

                    </h:dataTable>

                    <h:outputText value="No categories in the system."
                                  rendered="#{empty categoryViewBean.allCategories}"
                                  style="display: block; margin: 20px 0; font-style: italic; color: #666;" />
                </h:form>
            </section>
        </article>

    </ui:define>

</ui:composition>
</html>

